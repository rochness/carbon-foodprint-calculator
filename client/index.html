<!DOCTYPE html>
<html ng-app='calculator'>
  <head>
    <title>Carbon Foodprint Calculator</title>
    <link href='http://fonts.googleapis.com/css?family=Didact+Gothic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Arimo' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="stylesheet.css">
  </head>

  <body>
    <div class = "header">
      <img src="Zero-Food-Print_Logo.jpeg" height="150" width="150">
      <h1>CARBON CALCULATOR</h1>
    </div>
    <div class= "row" id="wrapper">
      <div class = "col-sm-7">
        <div class="calc_header">
          <h2>Intro Text TK TK TK TK</h2>
          <span> asasdsadOrum rem. Nequi dollendae vel iliscimi, cus molupta sperupt aspidem explaud iciditi sedArum sita des aute cor andi ut magnate ndenda velenis nostrume aut pro ommoluptati quiam
          </span>
        </div>
        <div class = "select_ingreds" ng-controller = "SearchController">
          <div class = "enter_ingred">
            <form name="searchForm" ng-submit="setIngred()">
              <input class="ingred_input" type="text" name="ingred" ng-model="input" ng-disabled="found===false" placeholder= "Type the name of an ingredient...">
              <button class="search_button" type="submit"> Search for Ingredient </button>
            </form>

            <div ng-switch="found">
              <div ng-switch-when="true">
                <form name="quantityForm" ng-if="$scope.ingredient !== null && searchForm.$submitted === true" ng-submit="addToList();searchForm.$setPristine(); quantityForm.$setPristine()" novalidate>
                Enter quantity (in pounds):
                <input type="number" name="quantity" ng-model="item.quantity">
                <button class="add_button" ng-if="searchForm.$dirty" type="submit"> Add ingredient </button>
                <button class="cancel_button" ng-if="searchForm.$dirty" ng-click="reset(); searchForm.$setPristine(); quantityForm.$setPristine()"> Cancel </button>
                </form>
              </div>
              <div ng-switch-when="false">
                <p>Sorry, we could not find your exact ingredient in our database. Try searching by category, entering another ingredient, or selecting a best match from below: </p>
                <ul>
                  <li ng-repeat="(ingred, ingObj) in allIngreds() | fuzzy:input">
                  <a class ="menu_item" ng-click= "setIngred(ingObj);setInput(item.ingredient.name);toggleFound()">{{ingObj.name}}</a>
                  </li>
                </ul>

                <button class="ok_button" ng-click="reset(); searchForm.$setPristine(); toggleFound()"> New Search </button>
              </div>
            </div>
          </div>
          <div class = "browse">
            <div class = 'or'> OR </div>
            <div class="selectCat"> Browse by Category </div>
            <div ng-switch="selected">
              <div class="row category_dropdowns" ng-switch-when='false'>
                <div class="col-sm-4">
                  <ul class="nav nav-stacked">
                    <li ng-repeat="category in categories.slice(0,4)">
                      <div class="btn-group dropright">
                        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#" ng-model="category">
                       {{category}}
                        <span class="glyphicon glyphicon-chevron-right"></span>
                        </a>
                        <ul class="dropdown-menu">
                          <li ng-repeat ="(ingred, ingObj) in allIngreds() | categoryFilter: category"><a ng-model="input" ng-click="setIngred(ingObj); toggleSelected()">{{ingObj.name}}</a></li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-4">
                  <ul class="nav nav-stacked">
                    <li ng-repeat="category in categories.slice(4,8)">
                      <div class="btn-group dropright">
                        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#" ng-model="category">
                       {{category}}
                        <span class="glyphicon glyphicon-chevron-right"></span>
                        </a>
                        <ul class="dropdown-menu">
                          <li ng-repeat ="(ingred, ingObj) in allIngreds() | categoryFilter: category"><a ng-model="input" ng-click="setIngred(ingObj); toggleSelected()">{{ingObj.name}}</a></li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-4">
                  <ul class="nav nav-stacked">
                    <li ng-repeat="category in categories.slice(8)">
                      <div class="btn-group dropright">
                        <a class="btn dropdown-toggle" data-toggle="dropdown" href="#" ng-model="category">
                       {{category}}
                        <span class="glyphicon glyphicon-chevron-right"></span>
                        </a>
                        <ul class="dropdown-menu">
                          <li ng-repeat ="(ingred, ingObj) in allIngreds() | categoryFilter: category"><a ng-model="input" ng-click="setIngred(ingObj); toggleSelected()">{{ingObj.name}}</a></li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="browse_quantity" ng-switch-when='true'>
                <div class="browse_selection"> Your selection: {{item.ingredient.name}} </div>
                <form name="quantityForm" novalidate>
                Enter quantity (in pounds):
                <input type="number" name="quantity" ng-model="item.quantity">
                <button class="add_button" ng-click="addToList(); quantityForm.$setPristine(); toggleSelected()"> Add ingredient </button>
                <button class="cancel_button" ng-click="reset(); quantityForm.$setPristine(); toggleSelected()"> Cancel </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

        <div class ="col-sm-5">
          <div class="calc_header"><h2>Your ingredients </h2></div>
          <div id="foodprint">
          <h3>Emissions breakdown</h3>
          <div class = "breakdown" ng-controller = "UserIngredController">
          <table>
            <tr ng-repeat= "ingred in getUserIngreds()">
              <td><form class="table_qty"><input type="number" ng-model="ingred.quantity"></form> pounds of {{ingred.ingredient.name}} </td>
              <td class ="emissions"> {{subTotal(ingred.quantity, ingred.ingredient.emissions)}} kg CO<sub>2</sub>e </td>
              <td class="emissions">
                <button type="button" data-toggle="modal" ng-attr-data-target={{'#'+ingred.ingredient.name+'modal'}}>Update</button>
                <button value="remove" ng-click="remove(ingred)">Remove</button>

              <div class="modal fade" ng-attr-id={{ingred.ingredient.name+'modal'}} tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Update Ingredient Details: {{ingred.ingredient.name}} </h4>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="modalText">Quantity (in pounds): </div>
                        <input class="update_input" type="number" name="quantity" ng-model="ingred.quantity">
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                      <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="addIngredient()">Save changes</button>
                    </div>
                  </div>
                </div>
              </div>
              </td>
            </tr>
          </table>



          <h3>Total</h3>
          <p>Your carbon foodprint is <span class="emphasize">{{total()}} kg of CO<sub>2</sub>e. </span>That is the equivalent of driving <span class="emphasize">{{miles()}} miles </span>in a car.</p>
          <p></p>
          <p></p>
          <h3>Offset</h3>
          <p>You can purchase <span class="emphasize"> ${{costs()}} </span> of carbon offsets to balance your emissions.</p>
          <p></p>
          <p></p>
          </div>
          </div>
        </div>
      </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="../bower_components/angular/angular.js"></script>
    <script src="../bower_components/angular-filter/dist/angular-filter.min.js"></script>
    <script src="../bower_components/angular-route/angular-route.js"></script>

    <script src="app/app.js"></script>
    <script src="app/calculate/calculate.js"></script>
    <script src="app/ingredient/search.js"></script>
    <script src="app/services.js"></script>
  </body>
  <footer>

  </footer>
</html>